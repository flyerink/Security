* 名称：PFM 支持版本命令的扩展
* 日期：2021-05-11
* 拉取请求：[#18](https://github.com/opencomputeproject/Security/pull/18)

# 客观的

在最初的设计中，PFM 仅支持一个固件组件。获取 PFM 中受支持版本列表的命令不需要任何额外的粒度。随着 PFM 结构版本 2 的引入，现在可以有多个独立的固件组件，每个组件都有自己的支持固件版本列表。获取 PFM 中所有组件的所有版本的完整列表并不总是有用的。以这种方式返回支持的版本会使搜索特定组件的特定版本变得更具挑战性。需要有一种方法来定位特定组件的受支持版本。

# 提议

更新 Get Platform Firmware Manifest Supported Firmware 命令以将可选字段添加到请求中以指定要查询的固件组件 ID。如果未提供这些可选字段，则将返回每个组件的每个版本。

# 规范变更列表

Get Platform Firmware Manifest Supported Firmware(https://github.com/opencomputeproject/Security/blob/master/RoT/Protocol/Challenge_Protocol.md#get-platform-firmware-manifest-supported-firmware)请求结构将更新包括：
1. 指定固件 ID 长度的单字节长度字段。
2. 可变长度、空终止的固件 ID 字符串。

# 实施指南

在处理 v1 PFM 时，指定任何固件 ID 都会返回错误，因为没有以这种格式指定的组件 ID。没有可选参数的命令将像往常一样运行。

# 考虑的替代方案

1. 由于当前命令仅返回 ASCII 字符串，因此响应有效负载可以只填充一个列表，其中包括使用固件 ID 后跟支持版本列表的每种固件类型的标题。当目的只是显示当前支持的内容时，这会很干净，但在查询列表以决定支持列表的情况下（例如，在主机 FW 更新期间检查支持时），这将不是很好。在这种情况下，您只想检查对特定固件类型的支持，而不是所有固件类型。

这将需要在客户端对响应内容进行大量假设，并且可能无法完全向后兼容。
2. 弃用现有命令并用提供支持此流程的必要语义的新命令替换它。这将清楚地区分支持新信息的设备与不支持新信息的设备。
最终，这种级别的功能划分被认为没有必要。
3. 不太明显的映射是支持清单中每个组件的独立端口。但是要知道哪些端口映射到 whay 组件将是一项挑战。由于每个 PFM 中的固件类型数量可变，因此端口映射不会是静态的。这不需要更改当前的命令结构，但可能是一个令人困惑的界面。

# 未来的工作

读回支持的固件版本的大量列表所需的优化。